<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Project 1</title>
    <link rel="icon" href="assets/images/muscleArmIcon.png">
    <link href="assets/css/style.css" rel="stylesheet">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <!-- Jumbotron -->
        <div class="jumbotron">
            <h1>Got Muscles?</h1>
            <p>Need a routine? Need a recipe? Need a gym? We got you!</p>
        </div>

        <!-- Container for workouts -->
        <div class="container" id="workouts">
            <h4>Get your routines here!</h4>

            <!-- Body group buttons -->
            <div class="row" id="workoutBtns">
                <button class="btn btn-warning" id="shoulderBtn" type="submit">Shoulders</button>
                <button class="btn btn-success" id="armsBtn" type="submit">Arms</button>
                <button class="btn btn-danger" id="chestBtn" type="submit">Chest</button>
                <button class="btn btn-primary" id="backBtn" type="submit">Back</button>
                <button class="btn btn-info" id="legsBtn" type="submit">Legs</button>
                <button class="btn btn-default" id="absBtn" type="submit">Abs</button>
            </div>

            <!-- Div for content retrieved from API -->
            <div id="workoutContentHere"></div>
        </div>

        <!-- Container for nutrituon -->
        <div class="container" id="nutrition">
            <h4>Hungry?</h4>
        </div>

    </div>

    <!-- <div class="container"> -->
    <input id="pac-input" class="controls" type="text" placeholder="Search City for Gym">

    <div id="map">
        <input type="text" placeholder="Search here">
        <span class="search glyphicon glyphicon-search"></span>
    </div>

    <!-- GOOGLE MAPS API CODE -->
    <script>
        // This api requires that you consent to location sharing when
        // prompted by your browser. If you see the error "The Geolocation service
        // failed.", it means you did not give permission for the browser to
        // locate you.
        var map, infoWindow,
            markers = [];
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 19.0759837, lng: 72.87765590000004 },
                zoom: 16
            });
            infoWindow = new google.maps.InfoWindow;

            if (navigator.geolocation) { //attempts to find current location of user
                navigator.geolocation.getCurrentPosition(function (position) {
                    pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };

                    infoWindow.setPosition(pos); //if current location is found it will position 
                    infoWindow.setContent('Location found.'); //the browser to be centered around that location
                    infoWindow.open(map);
                    map.setCenter(pos);
                    locateGym(map, pos);

                }, function () { //if it cannot it will go to 'handleLocationError' and the user will recieve an error notification                    
                    handleLocationError(true, infoWindow, map.getCenter());
                });
            } else {
                // Browser doesn't support Geolocation
                handleLocationError(false, infoWindow, map.getCenter());
            }

            var input = document.getElementById('pac-input');
            var searchBox = new google.maps.places.SearchBox(input);
            map.controls[google.maps.ControlPosition.TOP_LEFT].push(input); //searchbox located in top left corner of map
            // Bias the SearchBox results towards current map's viewport.
            map.addListener('bounds_changed', function () {
                searchBox.setBounds(map.getBounds());
            });

            searchBox.addListener('places_changed', function () { //recieves exact longitude and latitude of places
                var places = searchBox.getPlaces(),
                    lat = searchBox.getPlaces()[0].geometry.location.lat(),
                    lng = searchBox.getPlaces()[0].geometry.location.lng();
                map.setCenter(new google.maps.LatLng(lat, lng));
                pos = {
                    lat: lat,
                    lng: lng
                };
                infoWindow.setPosition(pos);
                infoWindow.setContent('Location found.');
                infoWindow.open(map);
                locateGym(map, pos)
            });
        }
        function locateGym(map, pos) { //places marker at gyms location
            places = new google.maps.places.PlacesService(map);
            var markerIcon = {
                url: 'https://d2gg9evh47fn9z.cloudfront.net/800px_COLOURBOX22676869.jpg',
                size: new google.maps.Size(60, 60),
                origin: new google.maps.Point(0, 0),
                anchor: new google.maps.Point(12, 10),
                scaledSize: new google.maps.Size(30, 30)
            };                          //radius is in meter
            places.textSearch({ location: pos, radius: 3000, query: 'workout' }, callback); //uses word workout to place the marker image
            function callback(results, status) {
                //clearResults(results);
                clearMarkers();
                console.log(results);
                markers = [];


                for (var i = 0; i < results.length; i++) {

                    // Use marker animation to drop the icons incrementally on the map.
                    markers = new google.maps.Marker({
                        position: new google.maps.LatLng(results[i].geometry.location.lat(), results[i].geometry.location.lng()),
                        icon: markerIcon,
                        map: map
                    });
                }
            }
        }

        function clearMarkers() {
            for (var i = 0; i < markers.length; i++) {
                if (markers[i]) {
                    markers[i].setMap(null);
                }
            }
            markers = [];
        }

        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
            infoWindow.setPosition(pos);
            infoWindow.setContent(browserHasGeolocation ?
                'Error: The Geolocation service failed.' :
                'Error: Your browser doesn\'t support geolocation.');
            infoWindow.open(map);
        }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBwMh07oJLiCVRHzgAgYE5JXlsanwRy9kU&libraries=places&type=gym&callback=initMap"></script>

    </div>
</body>
<script src="assets/javascript/app.js" type="text/javascript"></script>

</html>